# CLAUDE.md — AIアシスタント向けガイド（Othello）

このファイルは、AIアシスタント（Claude Codeなど）がこのリポジトリで作業する際のガイドラインを提供します。

## プロジェクト概要

**Othello** は、クラシックなオセロ（リバーシ）ボードゲームのWebベース実装です。Webブラウザ上で直接プレイできます。標準的なWeb技術（HTML、CSS、JavaScript）のみで構築され、サーバーサイドのコンポーネントはありません。

- **ライセンス:** MIT
- **対象プラットフォーム:** モダンなWebブラウザ（デスクトップおよびモバイル）

## リポジトリ構成

リポジトリは開発初期段階です。実装後の想定レイアウト：

```
Othello/
├── CLAUDE.md           # このファイル
├── README.md           # プロジェクト概要
├── LICENSE             # MIT ライセンス
├── index.html          # メインエントリポイント / ゲームUI
├── css/
│   └── style.css       # ゲームのスタイルとボードレイアウト
├── js/
│   ├── game.js         # コアゲームロジック（ルール、盤面状態）
│   ├── ai.js           # AI対戦ロジック（該当する場合）
│   └── ui.js           # DOM操作とイベントハンドリング
└── tests/
    └── game.test.js    # ゲームロジックのユニットテスト
```

## ゲームルールの概要

オセロは8×8のグリッド上でプレイします。2人のプレイヤーが交互にディスク（黒と白）を配置します。有効な手は、相手のディスクを直線（水平、垂直、または斜め）で1つ以上挟む場合のみです。挟まれたディスクは現在のプレイヤーの色にひっくり返されます。ボードが埋まるか、どちらのプレイヤーも有効な手がなくなった時点で、ディスクの多いプレイヤーが勝ちます。

正確に実装すべき重要なルール：
- 手を打つには、相手のディスクを少なくとも1つひっくり返せなければならない
- プレイヤーに有効な手がない場合、そのプレイヤーのターンはスキップされる
- どちらのプレイヤーにも有効な手がない場合、ゲームは終了する
- 初期配置では、中央に黒2つと白2つのディスクを対角線状に配置する

## 開発ワークフロー

### ローカル実行

純粋なフロントエンドプロジェクトのため、`index.html`をブラウザで直接開きます：

```bash
# 方法1: デフォルトブラウザで開く
open index.html          # macOS
xdg-open index.html      # Linux

# 方法2: CORSの問題を回避するためにシンプルなHTTPサーバーを使用
python3 -m http.server 8080
# その後 http://localhost:8080 にアクセス
```

### テスト

ゲームロジックのユニットテストは、ブラウザとNode.js環境の両方に対応する軽量フレームワーク（Jest や QUnit など）を使用します。

```bash
# Jest を使用する場合（設定完了後）
npm test

# 単一のテストファイルを実行
npx jest tests/game.test.js
```

### リンティングとフォーマット

JavaScriptには ESLint、フォーマットには Prettier を使用します（設定完了後）：

```bash
npx eslint js/
npx prettier --write js/ css/
```

## コーディング規約

### JavaScript

- **ES6+** 構文を使用する（const/let、アロー関数、テンプレートリテラル、クラス、モジュール）
- `let` よりも `const` を優先し、`var` は使用しない
- すべての公開関数に **JSDoc** コメントを記述する
- 盤面の状態は **長さ64の1次元配列** または **8×8の2次元配列** で表現する — どちらかを選択し、一貫して使用すること
- セルの値: `0` = 空、`1` = 黒、`2` = 白（または名前付き定数を使用）
- ゲームロジック（ルール、状態）をUI/DOMコードから厳密に分離する

### HTML/CSS

- セマンティックなHTML5要素を使用する
- CSS Grid または Flexbox を使用したモバイルレスポンシブレイアウト
- 色やサイズにはCSSカスタムプロパティ（変数）を使用する
- インラインスタイルを避け、すべてのスタイルを `css/style.css` にまとめる

### ファイル構成

- `game.js` は **DOM依存なし** — 純粋なロジックのみ — Node.jsでユニットテスト可能にする
- `ui.js` は `game.js` からインポートし、すべてのブラウザ操作を担当する
- バンドルする場合はESモジュール構文（`import`/`export`）を使用し、そうでなければ `index.html` 内で依存関係の順序を明確にして各ファイルを自己完結させる

## 実装上の重要事項

### 盤面の表現

推奨アプローチ：

```javascript
const EMPTY = 0;
const BLACK = 1;
const WHITE = 2;
const BOARD_SIZE = 8;

// 盤面の初期状態
function createInitialBoard() {
  const board = Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(EMPTY));
  board[3][3] = WHITE;
  board[3][4] = BLACK;
  board[4][3] = BLACK;
  board[4][4] = WHITE;
  return board;
}
```

### 手の妥当性チェック

`isValidMove(board, row, col, player)` 関数は非常に重要です。対象セルから8方向すべてをチェックし、相手のディスクが少なくとも1つ挟まれていることを確認する必要があります。

### 状態管理

すべてのミュータブルなゲーム状態を単一のオブジェクトにまとめることで、AIの先読みやアンドゥ機能のためのコピーが容易になります：

```javascript
const gameState = {
  board,          // 2次元配列
  currentPlayer,  // BLACK または WHITE
  scores,         // { [BLACK]: number, [WHITE]: number }
  gameOver,       // boolean
  winner,         // BLACK | WHITE | null（null = 引き分け）
};
```

## AIアシスタントへの指示

このリポジトリで作業する際の注意事項：

1. **変更を加える前に、このファイルと README.md を最初に読むこと**
2. **`game.js` を純粋に保つこと** — `document`、`window`、DOM参照を含めない
3. **コミット前にテストスイートを実行してロジックの変更をテストすること**
4. **こまめにコミットし**、以下の形式で説明的なメッセージを記述すること：
   - `feat: 有効な手のハイライト表示を追加`
   - `fix: 斜め方向のひっくり返し判定を修正`
   - `refactor: 方向ベクトルを定数に抽出`
   - `test: ボード端のポジションに関するテストを追加`
   - `style: prettierフォーマットを適用`
5. **既存のテストを壊さないこと** — 動作を変更する必要がある場合、テストも更新し、理由を説明すること
6. **シンプルな解決策を優先すること** — オセロのロジックは明確に定義されているため、過度な設計を避ける
7. **「有効な手がない」ケースを慎重に処理すること** — 最も見落とされやすいエッジケースの一つ

## よくある落とし穴

- 有効な手を計算する際に8方向すべてをチェックし忘れる
- ボードの境界チェックでのオフバイワン（1つずれ）エラー
- プレイヤーに有効な手がない場合にターンをスキップせず、ゲームを終了してしまう
- コピーではなく盤面の状態を直接変更してしまう（AIの先読みに重要）
- ゲームロジック関数に表示ロジックを混在させる

## Git ワークフロー

- ブランチ命名規則: `claude/<説明>-<セッションID>`
- すべての変更は適切なフィーチャーブランチにコミットすること
- *何を*変更し、*なぜ*変更したかを説明する明確なコミットメッセージを記述すること
- プッシュは `git push -u origin <ブランチ名>` を使用すること
